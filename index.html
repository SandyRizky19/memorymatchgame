<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memory Match Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
      body {
        background-color: #f8f9fa;
        text-align: center;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      .game-board {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        justify-content: center;
        max-width: 600px;
        margin: auto;
      }
      .card {
        width: 100%;
        aspect-ratio: 1/1;
        perspective: 1000px;
      }
      .card-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transition: transform 0.6s;
        transform-style: preserve-3d;
        cursor: pointer;
      }
      .card.flipped .card-inner {
        transform: rotateY(180deg);
      }
      .card-front,
      .card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        background-size: cover;
        background-position: center;
        border-radius: 10px;
      }
      .card-front {
        transform: rotateY(180deg);
      }
      .lives span {
        font-size: 1.5rem;
        margin: 0 5px;
        color: red;
      }
    </style>
  </head>

  <body>
    <div class="container mt-4" id="start-screen">
      <h1 class="mb-3">Memory Match</h1>
      <input type="text" class="form-control mb-3" id="playerName" placeholder="Masukkan Nama Anda" />
      <button class="btn btn-primary mb-3" onclick="startGame()">Start Game</button>
      <button class="btn btn-danger mb-3" onclick="resetScoreboard()">Reset Score</button>
      <h4>Scoreboard</h4>
      <ul id="scoreboard" class="list-group mb-3"></ul>
    </div>

    <div class="container" id="game-screen" style="display: none">
      <h3 id="countdown">3</h3>
      <div class="mb-2"><strong>Pemain:</strong> <span id="displayPlayer"></span> | <strong>Skor:</strong> <span id="displayScore">0</span></div>
      <div class="lives mb-2" id="lives"></div>
      <div class="game-board" id="game-board"></div>
    </div>

    <audio id="flipSound" src="sounds/flip.wav"></audio>
    <audio id="matchSound" src="sounds/match.wav"></audio>
    <audio id="failSound" src="sounds/fail.wav"></audio>
    <audio id="winSound" src="sounds/win.wav"></audio>

    <script>
      const fruitImages = ['images/apple.jpg', 'images/banana.jpg', 'images/grape.jpg', 'images/kiwi.jpg', 'images/cherry.jpg', 'images/strawberry.jpg', 'images/watermelon.jpg', 'images/pineapple.jpg'];

      let playerName = '';
      let lives = 3;
      let score = 0;
      let timer;

      const flipSound = document.getElementById('flipSound');
      const matchSound = document.getElementById('matchSound');
      const failSound = document.getElementById('failSound');
      const winSound = document.getElementById('winSound');

      function startGame() {
        playerName = document.getElementById('playerName').value.trim();
        if (!playerName) return alert('Masukkan nama terlebih dahulu.');

        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';

        document.getElementById('displayPlayer').textContent = playerName;
        document.getElementById('displayScore').textContent = 0;

        lives = 3;
        score = 0;
        showCountdown();
      }

      function showCountdown() {
        const countdown = document.getElementById('countdown');
        let counter = 3;
        countdown.textContent = counter;
        const interval = setInterval(() => {
          counter--;
          countdown.textContent = counter;
          if (counter === 0) {
            clearInterval(interval);
            countdown.textContent = 'Go!';
            setTimeout(() => {
              countdown.textContent = '';
              startRound();
            }, 1000);
          }
        }, 1000);
      }

      function startRound() {
        const board = document.getElementById('game-board');
        board.innerHTML = '';

        const selectedImages = shuffle([...fruitImages, ...fruitImages]);

        selectedImages.forEach((img) => {
          const card = document.createElement('div');
          card.className = 'card flipped';
          card.innerHTML = `
          <div class="card-inner">
            <div class="card-front" style="background-image: url('${img}')"></div>
            <div class="card-back" style="background-image: url('images/logo.png')"></div>
          </div>
        `;
          card.onclick = () => flipCard(card, img);
          board.appendChild(card);
        });

        showLives();
        setTimeout(() => {
          hideCards();
          startTimer();
        }, 3000);
      }

      function hideCards() {
        document.querySelectorAll('.card').forEach((card) => {
          card.classList.remove('flipped');
        });
      }

      let firstCard = null;
      let lockBoard = false;

      function flipCard(card, img) {
        if (lockBoard || card.classList.contains('flipped')) return;
        card.classList.add('flipped');
        flipSound.play();

        if (!firstCard) {
          firstCard = { card, img };
        } else {
          if (firstCard.img === img && firstCard.card !== card) {
            score++;
            document.getElementById('displayScore').textContent = score;
            matchSound.play();
            firstCard = null;
            checkWin();
          } else {
            lockBoard = true;
            failSound.play();
            setTimeout(() => {
              card.classList.remove('flipped');
              firstCard.card.classList.remove('flipped');
              firstCard = null;
              lockBoard = false;
            }, 1000);
          }
        }
      }

      function startTimer() {
        let time = 20;
        const countdown = document.getElementById('countdown');
        countdown.textContent = `${time} detik`;

        timer = setInterval(() => {
          time--;
          countdown.textContent = `${time} detik`;
          if (time <= 0) {
            clearInterval(timer);
            lives--;
            if (lives > 0) {
              showCountdown();
            } else {
              endGame();
            }
          }
        }, 1000);
      }

      function showLives() {
        const livesContainer = document.getElementById('lives');
        livesContainer.innerHTML = '';
        for (let i = 0; i < lives; i++) {
          const heart = document.createElement('span');
          heart.innerHTML = '❤️';
          livesContainer.appendChild(heart);
        }
      }

      function checkWin() {
        const flippedCards = document.querySelectorAll('.card.flipped');
        if (flippedCards.length === fruitImages.length * 2) {
          clearInterval(timer);
          winSound.play();
          endGame();
        }
      }

      function endGame() {
        saveScore();
        alert(`Permainan selesai! Skor Anda: ${score}`);
        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('start-screen').style.display = 'block';
        document.getElementById('playerName').value = '';
        loadScoreboard();
      }

      function saveScore() {
        const stored = JSON.parse(localStorage.getItem('scoreboard') || '[]');
        stored.push({ name: playerName, score });
        localStorage.setItem('scoreboard', JSON.stringify(stored));
      }

      function loadScoreboard() {
        const stored = JSON.parse(localStorage.getItem('scoreboard') || '[]');
        const list = document.getElementById('scoreboard');
        list.innerHTML = '';
        stored
          .sort((a, b) => b.score - a.score)
          .slice(0, 5)
          .forEach((entry) => {
            const item = document.createElement('li');
            item.className = 'list-group-item';
            item.textContent = `${entry.name}: ${entry.score}`;
            list.appendChild(item);
          });
      }

      function resetScoreboard() {
        if (confirm('Apakah Anda yakin ingin menghapus semua skor?')) {
          localStorage.removeItem('scoreboard');
          loadScoreboard();
        }
      }

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      loadScoreboard();
    </script>
  </body>
</html>
